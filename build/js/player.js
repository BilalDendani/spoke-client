define(["jquery","sharedAudio","clientSocket","promise"],function(e,t,n,r){console.log("> Loading player.js");var i=t.audioContext,s=n.socket,o=n.ioStream,u=function(t,n){if(!(this instanceof u))return new u(t,n);console.log("Creating new Player for stream",t),n=n||{},this.settings=e.extend({},u.DEFAULTS,n),this.$this=e(this),this.audioStream=t,this.audioDataArray=[],this.audioDataBuffer=null,this._listenToAudioStream()};return u.DEFAULTS={autoPlay:!0},u.socket=s,u.ioStream=o,u.prototype._listenToAudioStream=function(){var e=this;this.audioStream.on("data",function(t){e._onAudioData(t)}),this.audioStream.on("end",function(){e._onAudioEnd()})},u.prototype._onAudioData=function(e){this.audioDataArray.push(e)},u.prototype._onAudioEnd=function(){var e=0;for(var t=0;t<this.audioDataArray.length;t++)e+=this.audioDataArray[t].byteLength;this.audioDataBuffer=new Uint8Array(e);var n=0;for(var r=0;r<this.audioDataArray.length;r++){var i=new Uint8Array(this.audioDataArray[r]);this.audioDataBuffer.set(i,n),n+=i.byteLength}this.$this.trigger("ready.spoke.player"),this.settings.autoPlay&&this.playAudio()},u.prototype.playAudio=function(){var e=this;t.promiseDecodeAudioData(this.audioDataBuffer.buffer).then(t.promisePlayAudioData).then(function(){e.$this.trigger("done.spoke.player")})},u.prototype.on=function(e,t){this.$this.on(e,t)},u});